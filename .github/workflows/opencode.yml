name: opencode

on:
  pull_request:
    types: [opened, synchronize, reopened]
  workflow_dispatch:
    inputs:
      custom_prompt:
        description: 'Custom prompt untuk OpenCode'
        required: false
        type: string
        default: 'Please review and update any relevant documentation based on the changes in this pull request. Analyze code changes, identify any documentation that needs to be updated (README files, API docs, inline comments, etc.), and make necessary updates to ensure documentation stays in sync with the implementation.'

jobs:
  opencode:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: write
      pull-requests: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.sha }}

      - name: Run opencode
        uses: sst/opencode/github@latest
        env:
          IFLOW_API_KEY: ${{ secrets.IFLOW_API_KEY }}
        with:
          model: iflowcn/qwen3-coder
          prompt: |
            ${{ github.event.inputs.custom_prompt || 'Please review and update any relevant documentation based on the changes in this pull request. Analyze code changes, identify any documentation that needs to be updated (README files, API docs, inline comments, etc.), and make necessary updates to ensure documentation stays in sync with the implementation.' }}