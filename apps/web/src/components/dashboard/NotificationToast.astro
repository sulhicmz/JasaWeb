---
// NotificationToast.astro - Real-time notification component
---

<div id="notification-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

<script>
  class NotificationSystem {
    constructor() {
      this.container = document.getElementById('notification-container');
      this.notifications = [];
    }

    show(message, type = 'info', duration = 5000) {
      const id = Date.now().toString();
      const notification = { id, message, type, duration };
      
      this.notifications.push(notification);
      this.render(notification);
      
      // Auto-remove after duration
      setTimeout(() => {
        this.remove(id);
      }, duration);
    }

    render(notification) {
      const element = document.createElement('div');
      element.id = `notification-${notification.id}`;
      element.className = `notification-toast p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full`;
      
      const colors = {
        success: 'bg-green-500 text-white',
        error: 'bg-red-500 text-white',
        warning: 'bg-yellow-500 text-white',
        info: 'bg-blue-500 text-white'
      };
      
      const icons = {
        success: 'fas fa-check-circle',
        error: 'fas fa-exclamation-triangle',
        warning: 'fas fa-exclamation-triangle',
        info: 'fas fa-info-circle'
      };
      
      element.className += ` ${colors[notification.type]}`;
      element.innerHTML = `
        <div class="flex items-center space-x-3">
          <i class="${icons[notification.type]}"></i>
          <span class="flex-1">${notification.message}</span>
          <button onclick="notificationSystem.remove('${notification.id}')" class="hover:opacity-75">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      
      this.container.appendChild(element);
      
      // Animate in
      setTimeout(() => {
        element.classList.remove('translate-x-full');
        element.classList.add('translate-x-0');
      }, 10);
    }

    remove(id) {
      const element = document.getElementById(`notification-${id}`);
      if (element) {
        element.classList.add('translate-x-full');
        setTimeout(() => {
          element.remove();
          this.notifications = this.notifications.filter(n => n.id !== id);
        }, 300);
      }
    }

    // Global notification methods
    success(message, duration) {
      this.show(message, 'success', duration);
    }

    error(message, duration) {
      this.show(message, 'error', duration);
    }

    warning(message, duration) {
      this.show(message, 'warning', duration);
    }

    info(message, duration) {
      this.show(message, 'info', duration);
    }
  }

  // Create global instance
  window.notificationSystem = new NotificationSystem();

  // Listen for dashboard events and show notifications
  window.addEventListener('stats-updated', (e) => {
    window.notificationSystem.success('Dashboard stats updated successfully');
  });

  window.addEventListener('stats-error', (e) => {
    window.notificationSystem.error('Failed to update dashboard stats');
  });

  window.addEventListener('refresh-dashboard', () => {
    window.notificationSystem.info('Refreshing dashboard...');
  });
</script>

<style>
  .notification-toast {
    min-width: 300px;
    max-width: 400px;
  }
  
  .translate-x-full {
    transform: translateX(100%);
  }
  
  .translate-x-0 {
    transform: translateX(0);
  }
</style>