---
// src/components/portal/QuickActions.astro
---

<div class="bg-white rounded-lg shadow p-6 mb-8">
  <h2 class="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h2>
  
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    <!-- Create Project -->
    <button onclick="openCreateProjectModal()" class="flex flex-col items-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-colors group">
      <svg class="h-8 w-8 text-gray-400 group-hover:text-indigo-600 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg>
      <span class="text-sm font-medium text-gray-600 group-hover:text-indigo-600">New Project</span>
    </button>

    <!-- Create Ticket -->
    <button onclick="openCreateTicketModal()" class="flex flex-col items-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-colors group">
      <svg class="h-8 w-8 text-gray-400 group-hover:text-indigo-600 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
      </svg>
      <span class="text-sm font-medium text-gray-600 group-hover:text-indigo-600">New Ticket</span>
    </button>

    <!-- Upload File -->
    <button onclick="openFileUploadModal()" class="flex flex-col items-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-colors group">
      <svg class="h-8 w-8 text-gray-400 group-hover:text-indigo-600 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
      </svg>
      <span class="text-sm font-medium text-gray-600 group-hover:text-indigo-600">Upload File</span>
    </button>

    <!-- Request Approval -->
    <button onclick="openApprovalModal()" class="flex flex-col items-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-colors group">
      <svg class="h-8 w-8 text-gray-400 group-hover:text-indigo-600 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
      </svg>
      <span class="text-sm font-medium text-gray-600 group-hover:text-indigo-600">Request Approval</span>
    </button>
  </div>
</div>

<!-- Create Project Modal -->
<div id="createProjectModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
  <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
    <div class="mt-3">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Create New Project</h3>
      <form onsubmit="createProject(event)">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Project Name</label>
          <input type="text" id="projectName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
          <textarea id="projectDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
        </div>
        <div class="flex justify-end space-x-3">
          <button type="button" onclick="closeModal('createProjectModal')" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">
            Cancel
          </button>
          <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
            Create Project
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Create Ticket Modal -->
<div id="createTicketModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
  <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
    <div class="mt-3">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Create New Ticket</h3>
      <form onsubmit="createTicket(event)">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
          <input type="text" id="ticketTitle" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
          <textarea id="ticketDescription" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
          <select id="ticketPriority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <option value="low">Low</option>
            <option value="medium" selected>Medium</option>
            <option value="high">High</option>
            <option value="critical">Critical</option>
          </select>
        </div>
        <div class="flex justify-end space-x-3">
          <button type="button" onclick="closeModal('createTicketModal')" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300">
            Cancel
          </button>
          <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
            Create Ticket
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script client:load>
  // API configuration
  const API_BASE_URL = 'http://localhost:3001';

  // Modal functions
  function openCreateProjectModal() {
    document.getElementById('createProjectModal').classList.remove('hidden');
  }

  function openCreateTicketModal() {
    document.getElementById('createTicketModal').classList.remove('hidden');
  }

  function openFileUploadModal() {
    alert('File upload functionality will be implemented in a future update.');
  }

  function openApprovalModal() {
    alert('Approval request functionality will be implemented in a future update.');
  }

  function closeModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
  }

  // Create project
  async function createProject(event) {
    event.preventDefault();
    
    const name = document.getElementById('projectName').value;
    const description = document.getElementById('projectDescription').value;

    try {
      const token = localStorage.getItem('authToken');
      const response = await fetch(`${API_BASE_URL}/projects`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          name,
          description,
          status: 'planning'
        })
      });

      if (!response.ok) {
        throw new Error('Failed to create project');
      }

      // Close modal and reset form
      closeModal('createProjectModal');
      event.target.reset();
      
      // Show success message
      showNotification('Project created successfully!', 'success');
      
      // Reload projects to show the new one
      if (typeof loadProjects === 'function') {
        loadProjects();
      }

    } catch (error) {
      console.error('Error creating project:', error);
      showNotification('Failed to create project. Please try again.', 'error');
    }
  }

  // Create ticket
  async function createTicket(event) {
    event.preventDefault();
    
    const title = document.getElementById('ticketTitle').value;
    const description = document.getElementById('ticketDescription').value;
    const priority = document.getElementById('ticketPriority').value;

    try {
      const token = localStorage.getItem('authToken');
      const response = await fetch(`${API_BASE_URL}/tickets`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          title,
          description,
          priority,
          type: 'task'
        })
      });

      if (!response.ok) {
        throw new Error('Failed to create ticket');
      }

      // Close modal and reset form
      closeModal('createTicketModal');
      event.target.reset();
      
      // Show success message
      showNotification('Ticket created successfully!', 'success');

    } catch (error) {
      console.error('Error creating ticket:', error);
      showNotification('Failed to create ticket. Please try again.', 'error');
    }
  }

  // Show notification
  function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 p-4 rounded-md shadow-lg z-50 ${
      type === 'success' ? 'bg-green-500 text-white' : 
      type === 'error' ? 'bg-red-500 text-white' : 
      'bg-blue-500 text-white'
    }`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    // Remove notification after 3 seconds
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }

  // Close modals when clicking outside
  window.onclick = function(event) {
    if (event.target.classList.contains('fixed')) {
      event.target.classList.add('hidden');
    }
  }
</script>