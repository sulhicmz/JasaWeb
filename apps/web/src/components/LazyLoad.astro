---
// src/components/LazyLoad.astro
interface Props {
  threshold?: number;
  rootMargin?: string;
  class?: string;
}

const { 
  threshold = 0.1, 
  rootMargin = '0px',
  class: className = ''
} = Astro.props;
---

<div 
  class={`lazy-load ${className}`}
  data-threshold={threshold}
  data-root-margin={rootMargin}
  style="content-visibility: auto; contain-intrinsic-size: 0 500px;"
>
  <slot />
</div>

<script is:inline>
  // Lazy loading for heavy components
  const lazyElements = document.querySelectorAll('.lazy-load');
  
  if ('IntersectionObserver' in window) {
    const lazyObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const element = entry.target;
          element.style.contentVisibility = 'visible';
          element.style.containIntrinsicSize = 'auto';
          
          // Trigger custom event for component initialization
          element.dispatchEvent(new CustomEvent('lazyLoad'));
          
          lazyObserver.unobserve(element);
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '50px'
    });
    
    lazyElements.forEach(el => {
      lazyObserver.observe(el);
    });
  } else {
    // Fallback for older browsers
    lazyElements.forEach(el => {
      el.style.contentVisibility = 'visible';
      el.style.containIntrinsicSize = 'auto';
    });
  }
</script>