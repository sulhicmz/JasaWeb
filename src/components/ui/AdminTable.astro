---
/**
 * Admin Table Component
 * 
 * A powerful, configurable table component for admin management pages.
 * Supports custom column rendering, badges, date formatting, and conditional actions.
 * 
 * @example
 * ```astro
 * <!-- Basic user table -->
 * <AdminTable 
 *   data={users}
 *   columns={[
 *     { key: 'name', label: 'Name' },
 *     { key: 'email', label: 'Email' },
 *     { 
 *       key: 'role', 
 *       label: 'Role',
 *       badge: {
 *         variant: 'primary',
 *         condition: (value) => value === 'admin'
 *       }
 *     },
 *     { 
 *       key: 'createdAt', 
 *       label: 'Created',
 *       date: true 
 *     }
 *   ]}
 *   actions={[
 *     {
 *       href: (user) => `/admin/users/${user.id}/edit`,
 *       text: 'Edit',
 *       variant: 'primary',
 *       size: 'sm'
 *     }
 *   ]}
 * />
 * ```
 */
import Badge from './Badge.astro';
import Button from './Button.astro';

export interface Column {
  /** Property key to access from data object */
  key: string;
  /** Column header display text */
  label: string;
  /** Custom render function for complex cell content */
  render?: (item: any) => any;
  /** Badge configuration for status indicators */
  badge?: {
    /** Badge visual variant */
    variant: 'success' | 'primary' | 'warning' | 'error' | 'default';
    /** Conditional function to apply badge variant */
    condition?: (value: any) => boolean;
  };
  /** Whether to format value as date */
  date?: boolean;
}

export interface Action {
  /** Function to generate action URL from row data */
  href: (item: any) => string;
  /** Button display text */
  text: string;
  /** Button visual style variant */
  variant: 'primary' | 'secondary' | 'outline';
  /** Button size */
  size?: 'sm' | 'md' | 'lg';
  /** Conditional function to show/hide action */
  condition?: (item: any) => boolean;
}

export interface Props {
  /** Array of data objects to display in table */
  data: any[];
  /** Column configuration for table structure */
  columns: Column[];
  /** Optional action buttons for each row */
  actions?: Action[];
  /** Message to display when no data is available */
  emptyMessage?: string;
  /** Error message to display above table */
  error?: string;
  /** Additional CSS classes to apply */
  class?: string;
}

const { 
  data, 
  columns, 
  actions = [], 
  emptyMessage = 'No data found', 
  error = '',
  class: className = '' 
} = Astro.props;

function renderCell(item: any, column: Column) {
  const value = item[column.key];
  
  if (column.render) {
    return column.render(item);
  }
  
  if (column.badge) {
    return `<span class="inline-flex">${value}</span>`;
  }
  
  if (column.date) {
    return new Date(value).toLocaleDateString('id-ID');
  }
  
  if (value === null || value === undefined) {
    return '-';
  }
  
  return value;
}
---

<div class:list={["admin-table-container", className]}>
  {error && (
    <div class="admin-table-error">
      <p>Error: {error}</p>
    </div>
  )}

  <div class="admin-table-wrapper">
    {data.length === 0 ? (
      <div class="admin-table-empty">
        <p>{emptyMessage}</p>
      </div>
    ) : (
      <table class="admin-table">
        <thead>
          <tr class="admin-table-header-row">
            {columns.map((column) => (
              <th class="admin-table-header">
                {column.label}
              </th>
            ))}
            {actions.length > 0 && (
              <th class="admin-table-header">Actions</th>
            )}
          </tr>
        </thead>
        <tbody>
          {data.map((item) => (
            <tr class="admin-table-row">
              {columns.map((column) => (
                <td class="admin-table-cell">
                  {column.render ? (
                    <fragment set:html={column.render(item)} />
                  ) : column.badge ? (
                    <Badge variant={
                      column.badge.condition && column.badge.condition(item[column.key])
                        ? column.badge.variant
                        : 'default'
                    }>
                      {item[column.key]}
                    </Badge>
                  ) : column.date ? (
                    <div class="text-text-secondary text-sm">
                      {new Date(item[column.key]).toLocaleDateString('id-ID')}
                    </div>
                  ) : (
                    <div set:html={renderCell(item, column)} />
                  )}
                </td>
              ))}
              {actions.length > 0 && (
                <td class="admin-table-cell">
                  <div class="admin-table-actions">
                    {actions
                      .filter(action => !action.condition || action.condition(item))
                      .map((action) => (
                        <Button 
                          href={action.href(item)} 
                          variant={action.variant}
                          size={action.size || 'sm'}
                        >
                          {action.text}
                        </Button>
                      ))}
                  </div>
                </td>
              )}
            </tr>
          ))}
        </tbody>
      </table>
    )}
  </div>
</div>

<style>
  .admin-table-container {
    width: 100%;
  }

  .admin-table-wrapper {
    overflow-x: auto;
  }

  .admin-table {
    width: 100%;
    border-collapse: collapse;
  }

  .admin-table-header-row {
    border-bottom: 1px solid var(--color-border);
  }

  .admin-table-header {
    text-align: left;
    padding: 0.75rem 1rem;
    color: var(--color-text-secondary);
    font-weight: 500;
    font-size: 0.875rem;
    white-space: nowrap;
  }

  .admin-table-row {
    border-bottom: 1px solid var(--color-border);
    transition: background-color var(--transition-fast);
  }

  .admin-table-row:hover {
    background-color: var(--color-bg-secondary);
  }

  .admin-table-row:last-child {
    border-bottom: none;
  }

  .admin-table-cell {
    padding: 0.75rem 1rem;
    vertical-align: middle;
  }

  .admin-table-cell .font-medium,
  .admin-table-cell .text-white,
  .admin-table-cell .text-text,
  .admin-table-cell .text-text-secondary {
    font-weight: 500;
  }

  .admin-table-cell .text-white,
  .admin-table-cell .text-text {
    color: var(--color-text);
  }

  .admin-table-cell .text-text-secondary {
    color: var(--color-text-secondary);
  }

  .admin-table-cell .text-sm {
    font-size: 0.875rem;
  }

  .admin-table-cell a {
    color: var(--color-primary);
    text-decoration: none;
  }

  .admin-table-cell a:hover {
    text-decoration: underline;
  }

  .admin-table-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .admin-table-error {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    color: rgb(248, 113, 113);
    padding: 1rem;
    border-radius: var(--radius-lg);
    margin-bottom: 1.5rem;
  }

  .admin-table-empty {
    text-align: center;
    padding: 2rem;
  }

  .admin-table-empty p {
    color: var(--color-text-secondary);
    margin: 0;
  }

  @media (max-width: 768px) {
    .admin-table-header {
      padding: 0.5rem 0.75rem;
      font-size: 0.8rem;
    }

    .admin-table-cell {
      padding: 0.5rem 0.75rem;
    }

    .admin-table-actions {
      flex-direction: column;
      gap: 0.25rem;
    }

    .admin-table-actions button {
      width: 100%;
    }
  }
</style>